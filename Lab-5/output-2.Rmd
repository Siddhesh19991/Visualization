---
title: "Untitled"
output: html_document
date: "2024-09-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


### Assigment-2

```{r}
setwd("~/Downloads/M A S T E R S /Sem-3/Part-1/Visualization/labs/lab-5")
data = read.csv2("Oilcoal.csv",header = TRUE)
```


# Q.1) 

```{r}
library(plotly)
data %>% plot_ly(x = ~Oil, y = ~Coal, type = 'scatter',size = ~Marker.size,color=~Country, mode="markers", frame= ~Year)

```

- We see an exponential increase in the coal consumption for China with respect to the years. 
- Oil consumption in USA has bene an outlier since the beginning i.e 1965 with extraordinary consumption compared to the rest of the countries. 

Additionally the above 2 countries are the only ones with a marker size of 1 so this kind of trend can be due to their high population. 

While the trend of the rest of the countries hover around a certain range for the oil and coal consumption. 


# Q.2) 

```{r}
library(dplyr)

data_1<-data %>%filter(Country =="US" | Country == "Japan")


plot_ly(data_1, x=~Oil, y=~Coal,type = 'scatter',size = ~Marker.size,color=~Country, mode="markers", frame =~Year)%>%animation_opts(
  100, easing = "cubic", redraw = F
)

```


We see a drop in oil consumption during 1980-1984, which was due to the 1979 oil crisis which was cause due to the Iranian Revolution. This lead to the rise in oil prices, hence a reduction in consumption.

And due to this factor, there was a push towards coal to reduce reliance on oil and we can see that in the plot that after 1984, the coal consumption rose. 

We also see a drop in the consumption of oil between 2008-2009 for both countries which could be due to the financial crisis.  




# Q.3) 

```{r}
data_2 <- data%>% mutate(Oil_prop = (Oil/(Oil + Coal)) * 100)
data_3 <- data%>% mutate(Oil_prop = 0)

data_4 <- rbind(data_2,data_3)

data_4%>% plot_ly(x=~Country, y=~Oil_prop, frame =~Year,type = 'bar')%>%animation_opts(
  100, easing = "cubic", redraw = F
) %>% layout(showlegend = FALSE)
```

- We can see as the years have passed, the countries has started consuming more oil compared to coal. 
- The oil proportion for Brazil has remaining consistent throughout the period. 
- The highest change in oil proportion from 1965 to 2009 can be see in the France which started at 54.4% in 1965 and increased to 89.6%
- Chain has steady has the lowest oil proportion among the other countries throughout this entire time period. 


The advantage of the animated bar plot is that this plots helps to see easily compare different countries on the same scale while the bubble chart was a bit more difficult to compare due to the scale difference for the bigger countries i.e USA and China. The length of bars allows for easier visual quantification compared to the area of bubbles. Additionally, we are able to easily see whether countries are consuming more oil or coal as the year pass by which is harder to easily notice in the bubble chart. 


The disadvantage of the animated bar plot is that we cannot incorporate more dimensions which we can for a bubble chart. Also, we are only able to see the change over time across one-axis. Additionally, the plot makes it harder to find outliers and can get cluttered as we add more countries making it harder to analyze. 

# Q.4) 

```{r}

data_2 <- data%>% mutate(Oil_prop = (Oil/(Oil + Coal)) * 100)
data_3 <- data%>% mutate(Oil_prop = 0)

data_4 <- rbind(data_2,data_3)

data_4%>% plot_ly(x=~Country, y=~Oil_prop, frame =~Year,type = 'bar')%>%animation_opts(
  100, easing = "elastic", redraw = F
) %>% layout(showlegend = FALSE)

```


Advantage:
With the help of elastic easing we are also able to see the speed of change of the oil proportion between each year which helps us see if the oil production sharply increases or decreases in relation to coal between 2 time points. And this fast transition helps draw immediate attention to the user. 

Disadvantage: 
This fast transition can make it difficult to the users making it harder to grasp subtle changes.It can also be overwhelming to the user to see such fast transition. It can also distract the user from the actual insights from the data and be too focused on the animation itself. 

# Q.5) 

```{r}
library(tidyr)

reshaped_data <- data %>%
  select(Country, Year, Coal) %>%
  spread(key = Country, value = Coal) %>%
  arrange(Year)

rownames(reshaped_data) <- reshaped_data$Year
mat <- as.matrix(reshaped_data[, -1])

library(tourr)

mat <- rescale(mat)
set.seed(12345)
tour<- new_tour(mat, guided_tour(cmass), NULL)

steps <- c(0, rep(1/15, 200))
Projs<-lapply(steps, function(step_size){  
  step <- tour(step_size)
  if(is.null(step)) {
    .GlobalEnv$tour<- new_tour(mat, guided_tour(cmass), NULL)
    step <- tour(step_size)
  }
  step
}
)


tour_dat <- function(i) {
  step <- Projs[[i]]
  proj <- center(mat %*% step$proj)
  data.frame(x = proj[,1], y = proj[,2], state = rownames(mat))
}

# projection of each variable's axis
proj_dat <- function(i) {
  step <- Projs[[i]]
  data.frame(
    x = step$proj[,1], y = step$proj[,2], variable = colnames(mat)
  )
}

stepz <- cumsum(steps)

# tidy version of tour data

tour_dats <- lapply(1:length(steps), tour_dat)
tour_datz <- Map(function(x, y) cbind(x, step = y), tour_dats, stepz)
tour_dat <- dplyr::bind_rows(tour_datz)

# tidy version of tour projection data
proj_dats <- lapply(1:length(steps), proj_dat)
proj_datz <- Map(function(x, y) cbind(x, step = y), proj_dats, stepz)
proj_dat <- dplyr::bind_rows(proj_datz)

ax <- list(
  title = "", showticklabels = FALSE,
  zeroline = FALSE, showgrid = FALSE,
  range = c(-1.1, 1.1)
)

# for nicely formatted slider labels
options(digits = 3)
tour_dat <- highlight_key(tour_dat, ~state, group = "A")
tour <- proj_dat %>%
  plot_ly(x = ~x, y = ~y, frame = ~step, color = I("black")) %>%
  add_segments(xend = 0, yend = 0, color = I("gray80")) %>%
  add_text(text = ~variable) %>%
  add_markers(data = tour_dat, text = ~state, ids = ~state, hoverinfo = "text") %>%
  layout(xaxis = ax, yaxis = ax, showlegend = FALSE)#%>%animation_opts(frame=0, transition=0, redraw = F)
tour

```


```{r}
a <- data %>%
  select(Country, Year, Coal) %>%
  spread(key = Country, value = Coal) %>%
  arrange(Year)

a <- a %>% select(Year, Brazil)

ggplot(a, aes(Year, Brazil)) + geom_path(lineend = "butt",
linejoin = "round", linemitre = 1) 
```


Yes, we are able to find 2 clusters and they do correspond to different year ranges. One cluster is from 1965 to mid 1980s and the other cluster is from min 1980s to 2009. 

From the plot, we can see that Brazil has the biggest contribution to the projection. Based on the time-series plot for Brazil, we can see 2 distinct trends, one before mid 1980s and one after mid 1980s and this supports the clusters we found suggesting that impact that this variable has on creating the clusters. 
